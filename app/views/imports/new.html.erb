<% content_for :title, "Import Student Roster - #{@cohort.name}" %>

<div class="max-w-4xl mx-auto">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">Import Student Roster</h1>
        <p class="text-gray-600 mt-2">Upload a roster file for <strong><%= @cohort.name %></strong></p>
      </div>
      <%= link_to 'Back to Cohort', cohort_path(@cohort), 
            class: 'inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50' %>
    </div>
  </div>

  <!-- Import Instructions -->
  <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8">
    <h2 class="text-lg font-semibold text-blue-900 mb-4">How to Import Your Roster</h2>
    <div class="space-y-4 text-sm text-blue-800">
      <div class="flex items-start">
        <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-semibold text-xs mt-0.5">1</div>
        <div class="ml-3">
          <p class="font-medium">Upload your roster file</p>
          <p class="text-blue-700">Supported formats: PDF, Excel (.xlsx, .xls), or CSV</p>
        </div>
      </div>
      <div class="flex items-start">
        <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-semibold text-xs mt-0.5">2</div>
        <div class="ml-3">
          <p class="font-medium">AI parsing and analysis</p>
          <p class="text-blue-700">Our AI will extract student information and infer attributes like gender, agency level, department type, and seniority</p>
        </div>
      </div>
      <div class="flex items-start">
        <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-semibold text-xs mt-0.5">3</div>
        <div class="ml-3">
          <p class="font-medium">Review and confirm</p>
          <p class="text-blue-700">Review the AI inferences and make any necessary corrections before finalizing the import</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Upload Form -->
  <div class="bg-white shadow rounded-lg">
    <div class="px-6 py-4 border-b border-gray-200">
      <h3 class="text-lg font-medium text-gray-900">Upload Roster File</h3>
    </div>
    
    <div class="px-6 py-6">
      <%= form_with(model: [@cohort, @import_session], url: cohort_imports_path(@cohort), 
                    local: true, multipart: true, class: "space-y-6") do |form| %>
        
        <!-- File Upload -->
        <div class="space-y-2">
          <%= form.label :file, "Select roster file", 
                class: "block text-sm font-medium text-gray-700" %>
          
          <div class="flex items-center justify-center w-full">
            <label for="file-upload" class="flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors">
              <div class="flex flex-col items-center justify-center pt-5 pb-6">
                <svg class="w-8 h-8 mb-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                </svg>
                <p class="mb-2 text-sm text-gray-500">
                  <span class="font-semibold">Click to upload</span> or drag and drop
                </p>
                <p class="text-xs text-gray-500">PDF, Excel (.xlsx, .xls), or CSV files</p>
                <p class="text-xs text-gray-400 mt-2">Maximum file size: 10MB</p>
              </div>
              <input id="file-upload" name="import_session[file]" type="file" 
                     accept=".pdf,.xlsx,.xls,.csv"
                     class="hidden"
                     required />
            </label>
          </div>
          
          <% if @import_session.errors[:file].any? %>
            <p class="text-sm text-red-600"><%= @import_session.errors[:file].first %></p>
          <% end %>
        </div>

        <!-- Description -->
        <div class="space-y-2">
          <%= form.label :description, "Import description (optional)", 
                class: "block text-sm font-medium text-gray-700" %>
          <%= form.text_area :description, 
                placeholder: "e.g., Fall 2024 Cohort A - Initial roster",
                rows: 3,
                class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
          <p class="text-xs text-gray-500">This will help you identify the import session later</p>
        </div>

        <!-- Current Cohort Info -->
        <div class="bg-gray-50 p-4 rounded-md">
          <h4 class="text-sm font-medium text-gray-900 mb-2">Import Target</h4>
          <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
            <div>
              <span class="font-medium">Cohort:</span> <%= @cohort.name %>
            </div>
            <div>
              <span class="font-medium">Current Students:</span> <%= @cohort.students_count %>
            </div>
            <div>
              <span class="font-medium">Available Spots:</span> 
              <span class="<%= @cohort.available_spots > 0 ? 'text-green-600' : 'text-red-600' %>">
                <%= @cohort.available_spots %>
              </span>
            </div>
            <div>
              <span class="font-medium">Max Capacity:</span> <%= @cohort.max_students %>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="flex items-center justify-between pt-4">
          <div class="text-sm text-gray-500">
            By uploading, you agree to have the file processed using AI services
          </div>
          <div class="flex space-x-3">
            <%= link_to 'Cancel', cohort_path(@cohort), 
                  class: 'inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50' %>
            <%= form.submit "Upload and Process", 
                  class: 'inline-flex items-center px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500',
                  data: { disable_with: 'Processing...' } %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
  // File upload preview
  document.getElementById('file-upload').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const label = e.target.parentElement;
    
    if (file) {
      const fileName = file.name;
      const fileSize = (file.size / 1024 / 1024).toFixed(2);
      
      label.innerHTML = `
        <div class="flex flex-col items-center justify-center pt-5 pb-6">
          <svg class="w-8 h-8 mb-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          <p class="mb-2 text-sm text-gray-700 font-medium">${fileName}</p>
          <p class="text-xs text-gray-500">${fileSize} MB</p>
          <p class="text-xs text-green-600 mt-2">Ready to upload</p>
        </div>
      `;
    }
  });
</script>